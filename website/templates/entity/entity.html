{% extends "base.html" %}
{% block title %}Entity Filter and Sort{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="card p-4 shadow-sm card-custom">
        <h4 class="text-center mb-4 title">Filter and Sort Entities</h4>
        <form action="{{ url_for('entity.entity_table') }}" method="POST">
            <div class="row mb-3">
                <div class="col-md-12 d-flex align-items-center">
                    <span class="me-2" style="color: #ffb400;">Match Conditions:</span>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="matchCondition" id="matchAll" value="all" checked>
                        <label class="form-check-label" for="matchAll" style="color: #ffb400;">all</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="matchCondition" id="matchAny" value="any">
                        <label class="form-check-label" for="matchAny" style="color: #ffb400;">any</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="matchCondition" id="matchNot" value="not">
                        <label class="form-check-label" for="matchNot" style="color: #ffb400;">not</label>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3 d-flex align-items-center">
                    <label for="sortKey" class="form-label me-2" style="color: #ffb400;">Sort Key</label>
                    <input type="text" class="form-control" id="sortKey" name="sortKey" placeholder="Sort Key">
                </div>
                <div class="col-md-6 mb-3 d-flex align-items-center">
                    <label for="sortOrder" class="form-label me-2" style="color: #ffb400;">Sort Order</label>
                    <input type="text" class="form-control" id="sortOrder" name="sortOrder" placeholder="Sort Order">
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3 d-flex align-items-center">
                    <label for="maxRiskScoreSeverity" class="form-label me-2" style="color: #ffb400;">Max Risk Score Severity</label>
                    <input type="text" class="form-control" id="maxRiskScoreSeverity" name="maxRiskScoreSeverity" placeholder="Score Severity">
                </div>
                <div class="col-md-6 mb-3 d-flex align-items-center">
                    <label for="minRiskScoreSeverity" class="form-label me-2" style="color: #ffb400;">Min Risk Score Severity</label>
                    <input type="text" class="form-control" id="minRiskScoreSeverity" name="minRiskScoreSeverity" placeholder="Score Severity">
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3 d-flex align-items-center">
                    <input class="form-check-input" type="checkbox" id="accountLocked" name="accountLocked">
                    <label class="form-check-label ms-2" for="accountLocked" style="color: #ffb400;">Account Locked</label>
                </div>
                <div class="col-md-6 mb-3 d-flex align-items-center">
                    <input class="form-check-input" type="checkbox" id="archived" name="archived">
                    <label class="form-check-label ms-2" for="archived" style="color: #ffb400;">Archived</label>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6 mb-3 d-flex align-items-center">
                    <input class="form-check-input" type="checkbox" id="hasAgedPassword" name="hasAgedPassword">
                    <label class="form-check-label ms-2" for="hasAgedPassword" style="color: #ffb400;">Has Aged Password</label>
                </div>
                <div class="col-md-6 mb-3 d-flex align-items-center">
                    <input class="form-check-input" type="checkbox" id="hasExposedPassword" name="hasExposedPassword">
                    <label class="form-check-label ms-2" for="hasExposedPassword" style="color: #ffb400;">Has Exposed Password</label>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6 mb-3 d-flex align-items-center">
                    <input class="form-check-input" type="checkbox" id="impersonator" name="impersonator">
                    <label class="form-check-label ms-2" for="impersonator" style="color: #ffb400;">Impersonator</label>
                </div>
                <div class="col-md-6 mb-3 d-flex align-items-center">
                    <input class="form-check-input" type="checkbox" id="hasNeverExpiringPassword" name="hasNeverExpiringPassword">
                    <label class="form-check-label ms-2" for="hasNeverExpiringPassword" style="color: #ffb400;">Has Never Expiring Password</label>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6 mb-3 d-flex align-items-center">
                    <input class="form-check-input" type="checkbox" id="hasOpenIncidents" name="hasOpenIncidents">
                    <label class="form-check-label ms-2" for="hasOpenIncidents" style="color: #ffb400;">Has Open Incidents</label>
                </div>
                <div class="col-md-6 mb-3 d-flex align-items-center">
                    <input class="form-check-input" type="checkbox" id="hasVulnerableOs" name="hasVulnerableOs">
                    <label class="form-check-label ms-2" for="hasVulnerableOs" style="color: #ffb400;">Has Vulnerable OS</label>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6 mb-3 d-flex align-items-center">
                    <input class="form-check-input" type="checkbox" id="inactive" name="inactive">
                    <label class="form-check-label ms-2" for="inactive" style="color: #ffb400;">Inactive</label>
                </div>
                <div class="col-md-6 mb-3 d-flex align-items-center">
                    <input class="form-check-input" type="checkbox" id="stale" name="stale">
                    <label class="form-check-label ms-2" for="stale" style="color: #ffb400;">Stale</label>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6 mb-3 d-flex align-items-center">
                    <input class="form-check-input" type="checkbox" id="hasWeakPassword" name="hasWeakPassword">
                    <label class="form-check-label ms-2" for="hasWeakPassword" style="color: #ffb400;">Has Weak Password</label>
                </div>
                <div class="col-md-6 mb-3 d-flex align-items-center">
                    <input class="form-check-input" type="checkbox" id="isMarked" name="isMarked">
                    <label class="form-check-label ms-2" for="isMarked" style="color: #ffb400;">Is Marked</label>
                </div>
            </div>

            <div id="secondary-filters" style="display: none;">
                <div class="row">
                    <div class="col-md-6 mb-3 d-flex align-items-center">
                        <label for="accountCreationEndTime" class="form-label me-2" style="color: #ffb400;">Account Creation End Time</label>
                        <input type="datetime-local" class="form-control" id="accountCreationEndTime" name="accountCreationEndTime">
                    </div>
                    <div class="col-md-6 mb-3 d-flex align-items-center">
                        <label for="accountCreationStartTime" class="form-label me-2" style="color: #ffb400;">Account Creation Start Time</label>
                        <input type="datetime-local" class="form-control" id="accountCreationStartTime" name="accountCreationStartTime">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3 d-flex align-items-center">
                        <label for="accountExpirationEndTime" class="form-label me-2" style="color: #ffb400;">Account Expiration End Time</label>
                        <input type="datetime-local" class="form-control" id="accountExpirationEndTime" name="accountExpirationEndTime">
                    </div>
                    <div class="col-md-6 mb-3 d-flex align-items-center">
                        <label for="accountExpirationStartTime" class="form-label me-2" style="color: #ffb400;">Account Expiration Start Time</label>
                        <input type="datetime-local" class="form-control" id="accountExpirationStartTime" name="accountExpirationStartTime">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3 d-flex align-items-center">
                        <label for="mostRecentActivityEndTime" class="form-label me-2" style="color: #ffb400;">Most Recent Activity End Time</label>
                        <input type="datetime-local" class="form-control" id="mostRecentActivityEndTime" name="mostRecentActivityEndTime">
                    </div>
                    <div class="col-md-6 mb-3 d-flex align-items-center">
                        <label for="mostRecentActivityStartTime" class="form-label me-2" style="color: #ffb400;">Most Recent Activity Start Time</label>
                        <input type="datetime-local" class="form-control" id="mostRecentActivityStartTime" name="mostRecentActivityStartTime">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3 d-flex align-items-center">
                        <label for="passwordLastChangeEndTime" class="form-label me-2" style="color: #ffb400;">Password Last Change End Time</label>
                        <input type="datetime-local" class="form-control" id="passwordLastChangeEndTime" name="passwordLastChangeEndTime">
                    </div>
                    <div class="col-md-6 mb-3 d-flex align-items-center">
                        <label for="passwordLastChangeStartTime" class="form-label me-2" style="color: #ffb400;">Password Last Change Start Time</label>
                        <input type="datetime-local" class="form-control" id="passwordLastChangeStartTime" name="passwordLastChangeStartTime">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3 d-flex align-items-center">
                        <label for="agentIds" class="form-label me-2" style="color: #ffb400;">Agent IDs</label>
                        <input type="text" class="form-control" id="agentIds" name="agentIds" placeholder="[AgentId!]">
                    </div>
                    <div class="col-md-6 mb-3 d-flex align-items-center">
                        <label for="businessRoles" class="form-label me-2" style="color: #ffb400;">Business Roles</label>
                        <input type="text" class="form-control" id="businessRoles" name="businessRoles" placeholder="[BusinessRole]">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3 d-flex align-items-center">
                        <label for="domains" class="form-label me-2" style="color: #ffb400;">Domains</label>
                        <input type="text" class="form-control" id="domains" name="domains" placeholder="[String]">
                    </div>
                    <div class="col-md-6 mb-3 d-flex align-items-center">
                        <label for="entityIds" class="form-label me-2" style="color: #ffb400;">Entity IDs</label>
                        <input type="text" class="form-control" id="entityIds" name="entityIds" placeholder="[UUID]">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3 d-flex align-items-center">
                        <input class="form-check-input" type="checkbox" id="cloudEnabled" name="cloudEnabled">
                        <label class="form-check-label ms-2" for="cloudEnabled" style="color: #ffb400;">Cloud Enabled</label>
                    </div>
                    <div class="col-md-6 mb-3 d-flex align-items-center">
                        <input class="form-check-input" type="checkbox" id="cloudOnly" name="cloudOnly">
                        <label class="form-check-label ms-2" for="cloudOnly" style="color: #ffb400;">Cloud Only</label>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3 d-flex align-items-center">
                        <input class="form-check-input" type="checkbox" id="unmanaged" name="unmanaged">
                        <label class="form-check-label ms-2" for="unmanaged" style="color: #ffb400;">Unmanaged</label>
                    </div>
                    <div class="col-md-6 mb-3 d-flex align-items-center">
                        <input class="form-check-input" type="checkbox" id="watched" name="watched">
                        <label class="form-check-label ms-2" for="watched" style="color: #ffb400;">Watched</label>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6 mb-3 d-flex align-items-center">
                        <input class="form-check-input" type="checkbox" id="hasAccount" name="hasAccount">
                        <label class="form-check-label ms-2" for="hasAccount" style="color: #ffb400;">Has Account</label>
                    </div>
                </div>
            </div>

            <div class="d-flex justify-content-end mb-3">
                <button type="button" class="btn btn-link text-white" onclick="toggleAdvancedFilters()" style="font-size: 1.25rem;">
                    <span class="dropdown-icon">▼</span>
                </button>
            </div>

            <div class="d-grid">
                <button type="submit" class="btn btn-custom">Submit</button>
            </div>
        </form>
    </div>
</div>

<script>
    function toggleAdvancedFilters() {
        const secondaryFilters = document.getElementById('secondary-filters');
        const dropdownIcon = document.querySelector('.dropdown-icon');
        
        if (secondaryFilters.style.display === 'none') {
            secondaryFilters.style.display = 'block';
            dropdownIcon.innerText = '▲';
        } else {
            secondaryFilters.style.display = 'none';
            dropdownIcon.innerText = '▼';
        }
    }
</script>

<style>
    body {
        background-color: #0f4c81; /* Classic Blue */
        color: #ffffff; /* White text */
    }

    .container {
        max-width: 98%;
        padding: 15px;
    }

    .title {
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        color: #ffffff; /* White text */
    }

    .card-custom {
        background-color: #007d79; /* Turquoise */
        color: #ffffff; /* White text */
    }

    .container-custom {
        max-width: 500px;
        margin: 0 auto;
        text-align: center;
    }

    .form-label {
        flex-shrink: 0;
        margin-right: 1rem;
        color: #ffb400;
    }

    .form-control {
        flex: 1;
        border-radius: 0.3rem;
        background-color: #495057; /* Dark background for input fields */
        color: #ffffff; /* White text for input fields */
        border: 1px solid #ced4da;
    }

    .btn-custom {
        background-color: #ffb400; /* Gold */
        color: #000000; /* White text */
        font-weight: bold;
        transition: background-color 0.3s ease;
        border-radius: 10px;
        border: none;
    }

    .btn-custom:hover {
        background-color: #0f4c81; /* Classic Blue */
        color: #ffffff; /* White text */
    }

    .form-check-input {
        margin-right: 10px;
    }

    .form-check-label {
        font-size: 1.1em;
    }

    .d-flex {
        display: flex;
    }

    .align-items-center {
        align-items: center;
    }

    .ms-2 {
        margin-left: 0.5rem; /* Margin left for spacing */
    }

    .dropdown-icon {
        font-size: 24px;
        color: white;
    }
</style>

{% endblock %}
